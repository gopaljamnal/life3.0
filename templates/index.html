{% extends 'base.html' %}

{% block title %}Home - My Blog{% endblock %}

{% block header %}
<header>
    <img src="/static/uploads/profile.jpg" alt="Profile Picture" class="header-image">
</header>
{% endblock %}

{% block content %}
    <h1>Welcome to My Blog</h1>

    <div class="posts">
        {% for post in posts %}
            <div class="post" id="post-{{ post.id }}">
                <div class="post-content">
                    <h2>{{ post.title }}</h2>
                    <p class="post-date">{{ post.date }}</p>
                    <p>
                        {% if post.content|length > 100 %}
                            {{ post.content[:100] }}...
                            <a href="{{ url_for('view_post', post_id=post.id) }}">Read more</a>
                        {% else %}
                            {{ post.content }}
                        {% endif %}
                    </p>
                </div>
                {% if post.image_urls %}
                    <div class="post-images">
                        {% for image_url in post.image_urls %}
                            <img src="{{ image_url }}" alt="Post Image" class="responsive-image">
                        {% endfor %}
                    </div>
                {% endif %}
                <button class="view-button" data-post-id="{{ post.id }}">
                    <span class="view-count" id="view-count-{{ post.id }}">{{ post.get('views', 0) }}</span> <i class="fas fa-eye"></i>
                </button>
            </div>
        {% endfor %}
    </div>
    <script>
        $(document).ready(function(){
            $('.view-button').click(function(){
                var postId = $(this).data('post-id');
                $.post('/view/' + postId, function(data){
                    $('#view-count-' + postId).text(data.views);
                });
                $(this).prop('disabled', true);
            });
        });
    </script>
{% endblock %}
